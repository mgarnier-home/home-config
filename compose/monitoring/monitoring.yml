version: "3.8"

services:
  glances:
    container_name: glances
    restart: unless-stopped
    image: nicolargo/glances:ubuntu-latest-full
    pid: host
    ports:
      - 10000:61208
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock:ro
    environment:
      - GLANCES_OPT=-d -t 1 -w
      - NVIDIA_VISIBLE_DEVICES=all

  docker-socket-proxy:
    image: tecnativa/docker-socket-proxy
    container_name: docker-socket-proxy
    restart: unless-stopped
    environment:
      - BUILD=1
      - COMMIT=1
      - CONFIG=1
      - CONTAINERS=1
      - DISTRIBUTION=1
      - EXEC=1
      - GRPC=1
      - IMAGES=1
      - INFO=1
      - NETWORKS=1
      - NODES=1
      - PLUGINS=1
      - SERVICES=1
      - SESSION=1
      - SWARM=1
      - SYSTEM=1
      - TASKS=1
      - VOLUMES=1

    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
    ports:
      - 10001:2375


  watchtower:
    image: containrrr/watchtower:latest
    container_name: watchtower
    restart: unless-stopped
    environment:
      - TZ=Europe/Paris
      - WATCHTOWER_POLL_INTERVAL=900
      - WATCHTOWER_CLEANUP=true
      - WATCHTOWER_DEBUG=true
      - WATCHTOWER_NOTIFICATIONS=email
      - WATCHTOWER_NOTIFICATION_EMAIL_FROM=${MAIL_LOGIN}
      - WATCHTOWER_NOTIFICATION_EMAIL_TO=${INFO_MAIL_TO}
      - WATCHTOWER_NOTIFICATION_EMAIL_SERVER_USER=${MAIL_LOGIN}
      - WATCHTOWER_NOTIFICATION_EMAIL_SERVER_PASSWORD=${MAIL_PASSWORD}
      - WATCHTOWER_NOTIFICATION_EMAIL_SERVER=${MAIL_HOST}
      - WATCHTOWER_NOTIFICATION_EMAIL_SERVER_PORT=${MAIL_PORT}
      - WATCHTOWER_NOTIFICATION_EMAIL_DELAY=2
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
  
  # scrutiny_collector:
  #   image: ghcr.io/analogj/scrutiny:master-collector
  #   container_name: scrutiny_collector
  #   restart: unless-stopped
  #   cap_add:
  #     - SYS_RAWIO
  #     - SYS_ADMIN
  #   volumes:
  #     - /run/udev:/run/udev:ro
  #   environment:
  #     COLLECTOR_API_ENDPOINT: 'http://scrutiny.apollon.home'

