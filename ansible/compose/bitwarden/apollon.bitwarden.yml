name: bitwarden

services:
  bitwarden:
    image: vaultwarden/server:latest
    container_name: bitwarden
    restart: unless-stopped
    ports:
      - ${APOLLON_BITWARDEN_PORT}:80
    volumes:
      - type: volume
        source: fbx_docker_data
        target: /data
        volume:
          subpath: bitwarden
      - ${DOCKER_DATA}/bitwarden:/data
    labels:
      # - traefik-conf.port=${APOLLON_BITWARDEN_PORT}
      - my-traefik.http.services.apollon_bitwarden_test.port=APOLLON_BITWARDEN_PORT
      - my-traefik.http.routers.bitwarden.rule=Host(`bitwarden.int.${PUBLIC_DOMAIN_NAME}`)
      - my-traefik.http.routers.bitwarden.entrypoints=https
      - my-traefik.http.routers.bitwarden.service=apollon_bitwarden_test
      - my-traefik.http.routers.bitwarden.tls.certResolver=leresolver
      # - my-traefik.http.routers.bitwarden.middlewares=redirect-to-https@file,ip-wl@file
      # - my-traefik.http.routers.bitwarden-cert.rule=Host(`bitwarden.int.${PUBLIC_DOMAIN_NAME}.nf`)
      # - my-traefik.http.routers.bitwarden-cert.service=apollon_bitwarden
      # - my-traefik.http.routers.bitwarden-cert.entrypoints=https
      # # - my-traefik.http.routers.bitwarden-cert.middlewares=redirect-to-https@file
      # - my-traefik.http.routers.bitwarden-cert.tls.certResolver=leresolver
      # - my-traefik.http.routers.bitwarden-cert.tls.options=ca-mgarnier11@file

  # networks:
  #   - traefik-net
  # labels:
  #   - traefik.enable=true
  #   - traefik.http.services.bitwarden.loadbalancer.server.port=80
  #   - traefik.http.routers.bitwarden.rule=Host(`bitwarden.${DOMAIN_NAME}`)
  #   - traefik.http.routers.bitwarden.entrypoints=websecure
  #   - traefik.http.routers.bitwarden.tls.certResolver=leresolver
  #   - traefik.http.routers.bitwarden.middlewares=ip-wl@file
  #   - traefik.http.routers.bitwarden-cert.rule=Host(`bitwarden.${DOMAIN_NAME}.nf`)
  #   - traefik.http.routers.bitwarden-cert.entrypoints=websecure
  #   - traefik.http.routers.bitwarden-cert.tls.certResolver=leresolver
  #   - traefik.http.routers.bitwarden-cert.tls.options=ca-mgarnier11@file
